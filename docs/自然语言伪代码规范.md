# 自然语言伪代码规范

## 1. 概述
自然语言伪代码（NatPseudo）是一种结合自然语言表达力和编程逻辑的标记语言，可编译为可执行Python代码。核心设计原则：
- **人类可读优先**：使用自然语言表达程序逻辑
- **结构清晰**：通过关键词标识代码结构
- **兼容Python**：1:1转换为标准Python语法

## 2. 基础语法

### 2.1 函数定义
```markdown
定义函数 [函数名] 接受参数: [参数1], [参数2]
  执行: [操作描述]
  返回: [返回值描述]
```

**示例**:
```markdown
定义函数 计算折扣价 接受参数: 原价, 是否会员
  执行:
    如果 是否会员 为 True:
        折扣价 = 原价 * 0.8
    否则:
        折扣价 = 原价 * 0.9
  返回: 折扣价
```

### 2.2 类定义
```markdown
创建类 [类名] 包含:
  属性: 
    - [属性名] = [初始值]
  方法:
    - [方法名](参数): 
        执行: [操作描述]
```

**示例**:
```markdown
创建类 购物车 包含:
  属性:
    - 商品列表 = []
  方法:
    - 添加商品(商品):
        执行: 商品列表.追加(商品)
    - 计算总价():
        总价 = 0
        对于 商品 在 商品列表:
            总价 = 总价 + 商品.价格
        返回 总价
```

### 2.3 条件语句
```markdown
如果 [条件表达式]:
  执行: [操作A]
否则如果 [条件表达式]:
  执行: [操作B]
否则:
  执行: [操作C]
```

**示例**:
```markdown
如果 温度 > 30:
  执行: 打开空调()
否则如果 温度 > 20:
  执行: 打开风扇()
否则:
  执行: 打开暖气()
```

### 2.4 循环语句
```markdown
当 [条件表达式] 成立时:  # while循环
  重复执行: [操作描述]
  更新: [状态变更]

对于 [元素] 在 [集合]:  # for循环
  执行: [操作描述]
```

**示例**:
```markdown
当 未处理订单数 > 0 成立时:
  重复执行: 处理订单()
  更新: 未处理订单数 = 未处理订单数 - 1

对于 用户 在 用户列表:
  执行: 发送邮件(用户)
```

## 3. 包管理

### 3.1 包声明
```markdown
使用包:
  - [包名] [版本约束]
  - [包名] 作为 [别名]
```

**示例**:
```markdown
使用包:
  - pandas >=1.5.0
  - matplotlib.pyplot 作为 plt
  - sklearn.linear_model
```

### 3.2 转换规则
| NatPseudo 语法 | Python 等效 |
|----------------|-------------|
| `使用包: pandas` | `import pandas` |
| `使用包: numpy 作为 np` | `import numpy as np` |
| `使用包: sklearn.metrics` | `from sklearn import metrics` |

## 4. 模块系统

### 4.1 导入外部模块
```markdown
导入模块: "[相对路径]/[文件名].md" 作为 [别名]
```

**示例**:
```markdown
导入模块: "../utils/支付网关.md" 作为 支付

创建订单(金额):
  结果 = 支付.信用卡支付(金额)
  返回 结果
```

### 4.2 模块定义规则
1. 每个`.md`文件是一个独立模块
2. 文件名即模块名（不含扩展名）
3. 可导入的函数/类需在文件顶部声明：
   ```markdown
   # 导出: 函数1, 函数2, 类1
   ```

## 5. 特殊语法

### 5.1 错误处理
```markdown
尝试:
  执行: [可能出错的操作]
捕获 [异常类型] 作为 e:
  执行: [错误处理]
```

**示例**:
```markdown
尝试:
  执行: 文件 = 打开("data.txt")
捕获 FileNotFoundError 作为 e:
  执行: 打印("文件不存在")
```

### 5.2 异步支持
```markdown
异步定义函数 [函数名]:
  等待: [异步操作]
```

**示例**:
```markdown
异步定义函数 获取数据:
  等待: 数据 = 网络请求("https://api.example.com")
  返回 数据
```

## 6. 编译规则
1. **缩进处理**：2空格=1缩进层级
2. **注释保留**：以`#`开头的行保留为Python注释
3. **自动类型推导**：根据上下文推导变量类型
4. **元数据保留**：编译后的.py文件头部保留原始NatPseudo代码

## 7. 完整示例
```markdown
# 股票分析程序
使用包:
  - yfinance 作为 yf
  - mplfinance 作为 mpf

定义函数 分析股票(代码):
  数据 = yf.下载(代码, period="1mo")
  mpf.绘图(数据, type='candle', 标题=f"{代码}走势")
  返回 数据.描述()
```

> **提示**：此规范遵循"渐进式精确"原则，允许混合精确代码（如`yf.download()`）和自然语言描述（如"下载股票数据"）
